start() {
  if is_running; then
    echo 'Service NFQWS2 is already running' >&2
    return 1
  fi

  validate_config || return 1
  create_running_config
  kernel_modules

  $NFQWS_BIN --daemon --pidfile=$PIDFILE $(_startup_args)

  firewall_start
  system_config

  echo 'Started NFQWS2 service'
}

stop() {
  firewall_stop

  if ! is_running; then
    echo 'Service NFQWS2 is not running' >&2
    return 1
  fi

  echo 'Stopping NFQWS2 service...'
  kill -15 $(cat "$PIDFILE") && rm -f "$PIDFILE"
  remove_running_config
}

case "$1" in
  start)
    start
    ;;
  stop)
    stop
    ;;
  status)
    status_service
    ;;
  restart)
    stop
    start
    ;;
  reload)
    reload_service
    ;;
  firewall_reload)
    firewall_reload "$2" "$3"
    ;;
  firewall_start)
    firewall_start
    ;;
  firewall_stop)
    firewall_stop
    ;;
  kernel_modules)
    kernel_modules
    ;;
  *)
    echo "Usage: $0 {start|stop|restart|reload|status}"
esac
